{"version":3,"file":"normalize.js","sources":["../../../../node_modules/dagre/lib/normalize.js"],"sourcesContent":["\"use strict\";\n\nvar _ = require(\"./lodash\");\nvar util = require(\"./util\");\n\nmodule.exports = {\n  run: run,\n  undo: undo\n};\n\n/*\n * Breaks any long edges in the graph into short segments that span 1 layer\n * each. This operation is undoable with the denormalize function.\n *\n * Pre-conditions:\n *\n *    1. The input graph is a DAG.\n *    2. Each node in the graph has a \"rank\" property.\n *\n * Post-condition:\n *\n *    1. All edges in the graph have a length of 1.\n *    2. Dummy nodes are added where edges have been split into segments.\n *    3. The graph is augmented with a \"dummyChains\" attribute which contains\n *       the first dummy in each chain of dummy nodes produced.\n */\nfunction run(g) {\n  g.graph().dummyChains = [];\n  _.forEach(g.edges(), function(edge) { normalizeEdge(g, edge); });\n}\n\nfunction normalizeEdge(g, e) {\n  var v = e.v;\n  var vRank = g.node(v).rank;\n  var w = e.w;\n  var wRank = g.node(w).rank;\n  var name = e.name;\n  var edgeLabel = g.edge(e);\n  var labelRank = edgeLabel.labelRank;\n\n  if (wRank === vRank + 1) return;\n\n  g.removeEdge(e);\n\n  var dummy, attrs, i;\n  for (i = 0, ++vRank; vRank < wRank; ++i, ++vRank) {\n    edgeLabel.points = [];\n    attrs = {\n      width: 0, height: 0,\n      edgeLabel: edgeLabel, edgeObj: e,\n      rank: vRank\n    };\n    dummy = util.addDummyNode(g, \"edge\", attrs, \"_d\");\n    if (vRank === labelRank) {\n      attrs.width = edgeLabel.width;\n      attrs.height = edgeLabel.height;\n      attrs.dummy = \"edge-label\";\n      attrs.labelpos = edgeLabel.labelpos;\n    }\n    g.setEdge(v, dummy, { weight: edgeLabel.weight }, name);\n    if (i === 0) {\n      g.graph().dummyChains.push(dummy);\n    }\n    v = dummy;\n  }\n\n  g.setEdge(v, w, { weight: edgeLabel.weight }, name);\n}\n\nfunction undo(g) {\n  _.forEach(g.graph().dummyChains, function(v) {\n    var node = g.node(v);\n    var origLabel = node.edgeLabel;\n    var w;\n    g.setEdge(node.edgeObj, origLabel);\n    while (node.dummy) {\n      w = g.successors(v)[0];\n      g.removeNode(v);\n      origLabel.points.push({ x: node.x, y: node.y });\n      if (node.dummy === \"edge-label\") {\n        origLabel.x = node.x;\n        origLabel.y = node.y;\n        origLabel.width = node.width;\n        origLabel.height = node.height;\n      }\n      v = w;\n      node = g.node(v);\n    }\n  });\n}\n"],"names":["require$$0","require$$1"],"mappings":"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","x_google_ignoreList":[0]}