{"version":3,"file":"index.js","sources":["../../../../../node_modules/dagre/lib/order/index.js"],"sourcesContent":["\"use strict\";\n\nvar _ = require(\"../lodash\");\nvar initOrder = require(\"./init-order\");\nvar crossCount = require(\"./cross-count\");\nvar sortSubgraph = require(\"./sort-subgraph\");\nvar buildLayerGraph = require(\"./build-layer-graph\");\nvar addSubgraphConstraints = require(\"./add-subgraph-constraints\");\nvar Graph = require(\"../graphlib\").Graph;\nvar util = require(\"../util\");\n\nmodule.exports = order;\n\n/*\n * Applies heuristics to minimize edge crossings in the graph and sets the best\n * order solution as an order attribute on each node.\n *\n * Pre-conditions:\n *\n *    1. Graph must be DAG\n *    2. Graph nodes must be objects with a \"rank\" attribute\n *    3. Graph edges must have the \"weight\" attribute\n *\n * Post-conditions:\n *\n *    1. Graph nodes will have an \"order\" attribute based on the results of the\n *       algorithm.\n */\nfunction order(g) {\n  var maxRank = util.maxRank(g),\n    downLayerGraphs = buildLayerGraphs(g, _.range(1, maxRank + 1), \"inEdges\"),\n    upLayerGraphs = buildLayerGraphs(g, _.range(maxRank - 1, -1, -1), \"outEdges\");\n\n  var layering = initOrder(g);\n  assignOrder(g, layering);\n\n  var bestCC = Number.POSITIVE_INFINITY,\n    best;\n\n  for (var i = 0, lastBest = 0; lastBest < 4; ++i, ++lastBest) {\n    sweepLayerGraphs(i % 2 ? downLayerGraphs : upLayerGraphs, i % 4 >= 2);\n\n    layering = util.buildLayerMatrix(g);\n    var cc = crossCount(g, layering);\n    if (cc < bestCC) {\n      lastBest = 0;\n      best = _.cloneDeep(layering);\n      bestCC = cc;\n    }\n  }\n\n  assignOrder(g, best);\n}\n\nfunction buildLayerGraphs(g, ranks, relationship) {\n  return _.map(ranks, function(rank) {\n    return buildLayerGraph(g, rank, relationship);\n  });\n}\n\nfunction sweepLayerGraphs(layerGraphs, biasRight) {\n  var cg = new Graph();\n  _.forEach(layerGraphs, function(lg) {\n    var root = lg.graph().root;\n    var sorted = sortSubgraph(lg, root, cg, biasRight);\n    _.forEach(sorted.vs, function(v, i) {\n      lg.node(v).order = i;\n    });\n    addSubgraphConstraints(lg, cg, sorted.vs);\n  });\n}\n\nfunction assignOrder(g, layering) {\n  _.forEach(layering, function(layer) {\n    _.forEach(layer, function(v, i) {\n      g.node(v).order = i;\n    });\n  });\n}\n"],"names":["require$$0","require$$1","require$$2","require$$3","require$$4","require$$5","require$$6","require$$7"],"mappings":"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","x_google_ignoreList":[0]}