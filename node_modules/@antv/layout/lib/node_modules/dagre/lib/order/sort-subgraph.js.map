{"version":3,"file":"sort-subgraph.js","sources":["../../../../../node_modules/dagre/lib/order/sort-subgraph.js"],"sourcesContent":["var _ = require(\"../lodash\");\nvar barycenter = require(\"./barycenter\");\nvar resolveConflicts = require(\"./resolve-conflicts\");\nvar sort = require(\"./sort\");\n\nmodule.exports = sortSubgraph;\n\nfunction sortSubgraph(g, v, cg, biasRight) {\n  var movable = g.children(v);\n  var node = g.node(v);\n  var bl = node ? node.borderLeft : undefined;\n  var br = node ? node.borderRight: undefined;\n  var subgraphs = {};\n\n  if (bl) {\n    movable = _.filter(movable, function(w) {\n      return w !== bl && w !== br;\n    });\n  }\n\n  var barycenters = barycenter(g, movable);\n  _.forEach(barycenters, function(entry) {\n    if (g.children(entry.v).length) {\n      var subgraphResult = sortSubgraph(g, entry.v, cg, biasRight);\n      subgraphs[entry.v] = subgraphResult;\n      if (_.has(subgraphResult, \"barycenter\")) {\n        mergeBarycenters(entry, subgraphResult);\n      }\n    }\n  });\n\n  var entries = resolveConflicts(barycenters, cg);\n  expandSubgraphs(entries, subgraphs);\n\n  var result = sort(entries, biasRight);\n\n  if (bl) {\n    result.vs = _.flatten([bl, result.vs, br], true);\n    if (g.predecessors(bl).length) {\n      var blPred = g.node(g.predecessors(bl)[0]),\n        brPred = g.node(g.predecessors(br)[0]);\n      if (!_.has(result, \"barycenter\")) {\n        result.barycenter = 0;\n        result.weight = 0;\n      }\n      result.barycenter = (result.barycenter * result.weight +\n                           blPred.order + brPred.order) / (result.weight + 2);\n      result.weight += 2;\n    }\n  }\n\n  return result;\n}\n\nfunction expandSubgraphs(entries, subgraphs) {\n  _.forEach(entries, function(entry) {\n    entry.vs = _.flatten(entry.vs.map(function(v) {\n      if (subgraphs[v]) {\n        return subgraphs[v].vs;\n      }\n      return v;\n    }), true);\n  });\n}\n\nfunction mergeBarycenters(target, other) {\n  if (!_.isUndefined(target.barycenter)) {\n    target.barycenter = (target.barycenter * target.weight +\n                         other.barycenter * other.weight) /\n                        (target.weight + other.weight);\n    target.weight += other.weight;\n  } else {\n    target.barycenter = other.barycenter;\n    target.weight = other.weight;\n  }\n}\n"],"names":["require$$0","require$$1","require$$2","require$$3"],"mappings":"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","x_google_ignoreList":[0]}